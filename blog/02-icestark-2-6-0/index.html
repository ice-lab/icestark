<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="icestark Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="icestark Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BYD48PYEE0"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BYD48PYEE0",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="icestark" href="/opensearch.xml"><title data-react-helmet="true">icestark 2.6.0 | icestark</title><meta data-react-helmet="true" property="og:title" content="icestark 2.6.0 | icestark"><meta data-react-helmet="true" name="description" content="Announcing icestark 2.6.0"><meta data-react-helmet="true" property="og:description" content="Announcing icestark 2.6.0"><meta data-react-helmet="true" property="og:url" content="https://micro-frontends.ice.work/blog/02-icestark-2-6-0"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://micro-frontends.ice.work/blog/02-icestark-2-6-0"><link data-react-helmet="true" rel="alternate" href="https://micro-frontends.ice.work/blog/02-icestark-2-6-0" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://micro-frontends.ice.work/blog/02-icestark-2-6-0" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.27027981.css">
<link rel="preload" href="/assets/js/runtime~main.26065c09.js" as="script">
<link rel="preload" href="/assets/js/main.36bea538.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="icestark" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="icestark" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">ICESTARK</strong></a></div><div class="navbar__items navbar__items--right"><div class="searchWrapper_3rmH"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a class="navbar__item navbar__link" href="/docs/guide">文档</a><a class="navbar__item navbar__link" href="/docs/api/ice-stark">API</a><a class="navbar__item navbar__link" href="/docs/faq">常见问题</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">博客</a><a href="https://github.com/ice-lab/icestark" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="icestark" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="icestark" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">ICESTARK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/guide">文档</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/api/ice-stark">API</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq">常见问题</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">博客</a></li><li class="menu__list-item"><a href="https://github.com/ice-lab/icestark" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link"></a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/00-icestark-2-4-0">icestark 2.4.0</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/01-icestark-2-5-0">icestark 2.5.0</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/02-icestark-2-6-0">icestark 2.6.0</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/03-icestark-2-7-0">icestark 2.7.0</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">icestark 2.6.0</h1><div class="margin-vert--md"><time datetime="2023-09-20T07:39:16.120Z" class="blogPostDate_fNvV">September 20, 2023 · 7 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/maoxiaoke" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/13417006?v=4" alt="那吒"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/maoxiaoke" target="_blank" rel="noopener noreferrer">那吒</a></h4><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="announcing-icestark-260"></a>Announcing icestark 2.6.0<a class="hash-link" href="#announcing-icestark-260" title="Direct link to heading">#</a></h2><p>非常高兴地告诉大家，在 <a href="https://github.com/ice-lab/icestark/pull/369" target="_blank" rel="noopener noreferrer">2.6.0</a> 这个版本中，我们支持了 ES modules 模块类型的微应用。也就是说，如果您使用 <a href="https://vitejs.dev/" target="_blank" rel="noopener noreferrer">Vite</a> 或者 <a href="https://ice.work/docs/guide/basic/vite/" target="_blank" rel="noopener noreferrer">icejs Vite 模式</a> 开发的应用，可以使用 icestark 来构建您的微前端架构。</p><p>本次更新主要包括：</p><ul><li><a href="#%E6%94%AF%E6%8C%81-ES-modules-%E7%B1%BB%E5%9E%8B%E5%BE%AE%E5%BA%94%E7%94%A8">支持 ES modules 类型微应用</a></li><li><a href="#%E6%94%AF%E6%8C%81-angular-%E5%BE%AE%E5%BA%94%E7%94%A8">完善 Angular 微应用支持</a></li><li><a href="#%E4%BF%AE%E5%A4%8D%E5%AF%B9-locationhash-%E8%B5%8B%E5%80%BC-onroutechange-%E8%A7%A6%E5%8F%91%E4%B8%A4%E6%AC%A1%E7%9A%84%E9%94%99%E8%AF%AF">修复 location.hash 赋值 onRouteChange 触发两次的错误</a></li><li><a href="#%E5%AF%B9%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E7%9A%84%E6%94%B9%E9%80%A0">对项目配置的改造</a></li><li><a href="#ice.js-%E6%8F%92%E4%BB%B6%E6%94%AF%E6%8C%81-ES-modules-%E8%B5%84%E6%BA%90">ice.js 插件支持 ES modules 资源</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="支持-es-modules-类型微应用"></a>支持 ES modules 类型微应用<a class="hash-link" href="#支持-es-modules-类型微应用" title="Direct link to heading">#</a></h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules" target="_blank" rel="noopener noreferrer">ES modules</a> 模块规范是面向未来的模块规范，诸如 <a href="https://vitejs.dev/" target="_blank" rel="noopener noreferrer">Vite</a>、<a href="https://www.snowpack.dev/" target="_blank" rel="noopener noreferrer">snowpack</a> 等原生支持 ES modules 的构建工具的产生，以及 <a href="https://web.dev/publish-modern-javascript/" target="_blank" rel="noopener noreferrer">现代浏览器</a> 对 ES modules 语法的支持，相信未来会有越来越多的微应用构建在 native ES modules 之上。相比传统的构建工具（比如 webpack），这些新型的构建工具或多或少地带来了以下优势：</p><ul><li><strong>由于无需打包的特性，服务器启动时间超快</strong></li><li><strong>项目大小不再成为服务器启动速度的限制因素</strong></li><li><strong>HMR 始终保持快速更新</strong></li></ul><p>随着 <a href="https://ice.work/" target="_blank" rel="noopener noreferrer">icejs</a> 支持 <a href="https://ice.work/docs/guide/basic/vite/" target="_blank" rel="noopener noreferrer">Vite</a> 模式，icestark 也为大家带来了 ES modules 类型微应用的支持。</p><p>框架应用接入 ES modules 微应用的方式非常简单，配置 <code>loadScriptMode: import</code> 来支持 ES modules 类型微应用的加载。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><div tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token deleted-arrow deleted prefix deleted" style="color:rgb(255, 85, 114)">&lt;</span><span class="token deleted-arrow deleted line" style="color:rgb(255, 85, 114)">AppRouter&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token deleted-arrow deleted line" style="color:rgb(255, 85, 114)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> &lt;AppRoute</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   title=&quot;商家平台&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">   loadScriptMode=&quot;import&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   url={[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     &#x27;//unpkg.com/icestark-child-seller/build/js/index.js&#x27;, // 资源 ES modules 入口</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     &#x27;//unpkg.com/icestark-child-seller/build/css/index.css&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   ]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> /&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> &lt;AppRoute</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   path=&quot;/user&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   //...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> /&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-arrow deleted prefix deleted" style="color:rgb(255, 85, 114)">&lt;</span><span class="token deleted-arrow deleted line" style="color:rgb(255, 85, 114)">/AppRouter&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>对于 Vite 应用的 icestark 适配，可参考 <a href="/../docs/guide/use-child/others#Vite-%E5%BA%94%E7%94%A8">其他框架接入微应用 - Vite 应用</a> 进行配置。后期，我们将提供 Vite plugin 能力，使 Vite 应用的接入非常简单。</p><p>对于 ice.js 子应用，只需将 <a href="https://ice.work/docs/guide/advanced/icestark" target="_blank" rel="noopener noreferrer"><code>build-plugin-icestark</code></a> 升级到最新版本，并开启 <a href="https://ice.work/docs/guide/basic/vite" target="_blank" rel="noopener noreferrer">icejs Vite 模式</a>，即可完成改造工作。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="es-modules-微应用的常见问题解答"></a>ES modules 微应用的常见问题解答<a class="hash-link" href="#es-modules-微应用的常见问题解答" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="框架应用需要是-vite-应用吗"></a>框架应用需要是 Vite 应用吗？<a class="hash-link" href="#框架应用需要是-vite-应用吗" title="Direct link to heading">#</a></h4><p><strong>不需要</strong>。框架应用可以使用 webpack 等非 ES modules 构建工具，无需对框架应用进行任何构建上的改造。对于框架应用，唯一需要做的是：升级最新的 icestark 版本，并设置 ES modules 微应用的加载方式（<code>loadScriptMode</code> 字段） 设置为 <code>import</code> 即可。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="支持沙箱模式吗"></a>支持沙箱模式吗？<a class="hash-link" href="#支持沙箱模式吗" title="Direct link to heading">#</a></h4><p>暂不支持沙箱模式。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="为什么要使用-es-modules-微应用"></a>为什么要使用 ES modules 微应用<a class="hash-link" href="#为什么要使用-es-modules-微应用" title="Direct link to heading">#</a></h4><p>除了本地开发的优秀体验，由于 ES modules 脚本<a href="https://dmitripavlutin.com/javascript-module-import-twice/" target="_blank" rel="noopener noreferrer">只执行一次</a>的策略，微应用二次加载的速度基本没有延迟，极高地提升二次加载体验。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="浏览器的版本支持"></a>浏览器的版本支持<a class="hash-link" href="#浏览器的版本支持" title="Direct link to heading">#</a></h4><p>由于 icestark 内部使用 <a href="https://github.com/tc39/proposal-dynamic-import" target="_blank" rel="noopener noreferrer">dynamic import</a> 来支持 ES modules 应用，因此支持 chrome 63 版本以上的浏览器。</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>有关使用 ES modules 的其他疑问，欢迎通过 <a href="https://github.com/ice-lab/icestark/issues" target="_blank" rel="noopener noreferrer">issue</a> 或 <a href="https://github.com/ice-lab/icestark/discussions" target="_blank" rel="noopener noreferrer">discussion</a> 告知我们。</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="完善-angular-微应用"></a>完善 Angular 微应用<a class="hash-link" href="#完善-angular-微应用" title="Direct link to heading">#</a></h3><p>Angular 1.x 应用我们建议通过 <a href="/../docs/guide/concept/child#2-entry">entry</a> 方式接入，因为我们没有比较好的方式来定义 <a href="/../docs/guide/concept/child#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">生命周期函数</a>。在 Angular 5.x 及以上的版本，我们可以通过 <a href="https://angular.io/api/core/PlatformRef#bootstrapModule" target="_blank" rel="noopener noreferrer">bootstrapModule</a> 获取到 NgModule 实例。因此可以通过下面的方式定义生命周期函数：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ts"><div tabindex="0" class="prism-code language-ts codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">NgModuleRef</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@angular/core&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> app</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token maybe-class-name">NgModuleRef</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">AppModule</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token function" style="color:rgb(130, 170, 255)">isInIcestark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">platformBrowserDynamic</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">bootstrapModule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">mount</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  app </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">platformBrowserDynamic</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">bootstrapModule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">unmount</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// @ts-ignore</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">destroy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>同时，为了适配 Angular 应用，icestark 做了如下改动：</p><ul><li>兼容 Angular 的 <code>&lt;base /&gt;</code> 元素 - icestark 现在会默认解析 entry 或 entryContent 中的 <code>&lt;base&gt;</code> 元素的 <code>href</code>，并将其作为该微应用最终的 publicPath 的一个基准因子。解析完成后，该 <code>&lt;base &gt;</code> 元素不会出现在 DOM 结构中（否则可能修改其他应用的资源地址）。</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="修复对-locationhash-赋值-onroutechange-触发两次的错误"></a>修复对 location.hash 赋值 onRouteChange 触发两次的错误<a class="hash-link" href="#修复对-locationhash-赋值-onroutechange-触发两次的错误" title="Direct link to heading">#</a></h3><p>由于对 <code>window.location.hash</code> 进行赋值，会触发 popstate 和 hashchange 两个事件，导致钩子函数 <a href="/../docs/api/ice-stark#startconfiguration">onRouteChange</a> 触发两次。版本 2.6.0 修复了这个问题。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="对项目配置的改造"></a>对项目配置的改造<a class="hash-link" href="#对项目配置的改造" title="Direct link to heading">#</a></h3><p>由于 icestark 内部使用 <a href="https://github.com/tc39/proposal-dynamic-import" target="_blank" rel="noopener noreferrer">dynamic import</a> 来支持 ES modules 应用，因此需要对 icestark 工程进行一些适配，保证 dynamic import 不会被转译。项目 <code>tsconfig.json</code> 的改动如下：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;compilerOptions&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;target&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;es5&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;module&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;commonjs&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;module&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;esnext&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;moduleResolution&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Node&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;allowSyntheticDefaultImports&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;esModuleInterop&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>也就是说，之前版本的 icestark 的默认产物是 commonjs 规范；2.6.0 的版本的默认产物会是 ES modules 规范。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="icejs-插件支持-es-modules-资源"></a>ice.js 插件支持 ES modules 资源<a class="hash-link" href="#icejs-插件支持-es-modules-资源" title="Direct link to heading">#</a></h3><p><a href="https://ice.work/" target="_blank" rel="noopener noreferrer">ice.js</a> 可通过定制插件 <a href="https://ice.work/docs/guide/advanced/icestark" target="_blank" rel="noopener noreferrer">build-plugin-icestark</a> 快速接入 icestark。在该插件的最新版本中，我们支持开启 <a href="https://ice.work/docs/guide/basic/vite" target="_blank" rel="noopener noreferrer">Vite 模式</a> 的 ice.js 应用快速接入。</p><p>首先，需要将 <code>build-plugin-icestark</code> 升级至最新版本：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> i build-plugin-icestark@latest -D</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>并将 <code>ice.js</code> 升级至 2.x 版本。详见<a href="https://ice.work/docs/guide/upgrade#%E4%BB%8E-icejs-1x-%E5%8D%87%E7%BA%A7" target="_blank" rel="noopener noreferrer">升级指南</a>。</p><p>然后，在微应用的构建配置（<code>build.json</code>）中，修改成 <code>Vite</code> 模式：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><div tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> &quot;vite&quot;: true,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token plain">&quot;plugins&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> [&quot;build-plugin-icestark&quot;, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    &quot;type&quot;: &quot;child&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">    &quot;umd&quot;: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> }],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="后续的版本计划"></a>后续的版本计划<a class="hash-link" href="#后续的版本计划" title="Direct link to heading">#</a></h2><p>我们会持续扩展 icestark 的能力，提升微前端体验。在接下来的版本中，我们会：</p><ul><li>为 Vite 微应用提供对应的改造插件</li><li>优化开发者开发体验，dev 下提供关键路径的 log 信息</li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/v-2">v2</a><a class="margin-horiz--sm" href="/blog/tags/announcement">announcement</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/01-icestark-2-5-0"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« icestark 2.5.0</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/03-icestark-2-7-0"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">icestark 2.7.0 »</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#announcing-icestark-260" class="table-of-contents__link">Announcing icestark 2.6.0</a><ul><li><a href="#支持-es-modules-类型微应用" class="table-of-contents__link">支持 ES modules 类型微应用</a></li><li><a href="#es-modules-微应用的常见问题解答" class="table-of-contents__link">ES modules 微应用的常见问题解答</a></li><li><a href="#完善-angular-微应用" class="table-of-contents__link">完善 Angular 微应用</a></li><li><a href="#修复对-locationhash-赋值-onroutechange-触发两次的错误" class="table-of-contents__link">修复对 location.hash 赋值 onRouteChange 触发两次的错误</a></li><li><a href="#对项目配置的改造" class="table-of-contents__link">对项目配置的改造</a></li><li><a href="#icejs-插件支持-es-modules-资源" class="table-of-contents__link">ice.js 插件支持 ES modules 资源</a></li></ul></li><li><a href="#后续的版本计划" class="table-of-contents__link">后续的版本计划</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">社区</h4><ul class="footer__items"><li class="footer__item"><a href="https://iceworks.oss-cn-hangzhou.aliyuncs.com/assets/images/ice-group.png" target="_blank" rel="noopener noreferrer" class="footer__link-item">社区钉钉群</a></li><li class="footer__item"><a href="https://iceworks.oss-cn-hangzhou.aliyuncs.com/assets/images/ice-group-inside.JPG" target="_blank" rel="noopener noreferrer" class="footer__link-item">阿里内部钉钉群</a></li><li class="footer__item"><a href="https://github.com/ice-lab/icestark/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issue</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">帮助</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/ice-lab/icestark/issues/new?assignees=&amp;labels=bug&amp;template=bug_report.md" target="_blank" rel="noopener noreferrer" class="footer__link-item">反馈问题</a></li><li class="footer__item"><a href="https://github.com/ice-lab/icestark/issues/new" target="_blank" rel="noopener noreferrer" class="footer__link-item">提交需求</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">更多</h4><ul class="footer__items"><li class="footer__item"><a href="https://ice.work/" target="_blank" rel="noopener noreferrer" class="footer__link-item">飞冰（ICE）</a></li><li class="footer__item"><a href="https://rax.js.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Rax</a></li><li class="footer__item"><a href="https://appworks.site" target="_blank" rel="noopener noreferrer" class="footer__link-item">AppWorks</a></li><li class="footer__item"><a href="https://openkraken.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kraken</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 飞冰（ICE）. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.26065c09.js"></script>
<script src="/assets/js/main.36bea538.js"></script>
</body>
</html>